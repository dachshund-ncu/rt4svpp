<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>CCfits: Creating and Writing to a Binary Table Extension</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CCfits
   &#160;<span id="projectnumber">2.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Creating and Writing to a Binary Table Extension </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Binary Table interface is more complex because there is an additional parameter, the vector size of each `cell' in the table, the need to support variable width columns, and the desirability of supporting the input of data in various formats.</p>
<p>The interface supports writing to vector tables the following data structures: C-arrays (T*), std::vector&lt;T&gt; objects, std::valarray&lt;T&gt; objects, and std::vector&lt;valarray&lt;T&gt; &gt;. The last of these is the internal representation of the data.</p>
<p>The function below exercises the following functionality:</p>
<ul>
<li>Create a BinTable extension</li>
<li>Write vector rows to the table</li>
<li>Insert table rows</li>
<li>Write complex data to both scalar and vector columns.</li>
<li>Insert Table columns</li>
<li>Delete Table rows</li>
<li>Write HISTORY and COMMENT cards to the Table</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> writeBinary ()</div>
<div class="line"></div>
<div class="line"><span class="comment">//*********************************************************************</span></div>
<div class="line"><span class="comment">// Create a BINARY table extension and write and manipulate vector rows </span></div>
<div class="line"><span class="comment">//*********************************************************************</span></div>
<div class="line">{</div>
<div class="line">    std::auto_ptr&lt;FITS&gt; pFits(0);</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">            </div>
<div class="line">        <span class="keyword">const</span> std::string fileName(<span class="stringliteral">&quot;atestfil.fit&quot;</span>);</div>
<div class="line">        pFits.reset( <span class="keyword">new</span> FITS(fileName,Write) );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<a class="code" href="classCCfits_1_1FITS_1_1CantOpen.html">CCfits::FITS::CantOpen</a>)</div>
<div class="line">    {</div>
<div class="line">          <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">        </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> rows(3);</div>
<div class="line">    <span class="keywordtype">string</span> hduName(<span class="stringliteral">&quot;TABLE_BINARY&quot;</span>);</div>
<div class="line">    std::vector&lt;string&gt; colName(7,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    std::vector&lt;string&gt; colForm(7,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    std::vector&lt;string&gt; colUnit(7,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    colName[0] = <span class="stringliteral">&quot;numbers&quot;</span>;</div>
<div class="line">    colName[1] = <span class="stringliteral">&quot;sequences&quot;</span>;</div>
<div class="line">    colName[2] = <span class="stringliteral">&quot;powers&quot;</span>;</div>
<div class="line">    colName[3] = <span class="stringliteral">&quot;big-integers&quot;</span>;</div>
<div class="line">    colName[4] = <span class="stringliteral">&quot;dcomplex-roots&quot;</span>;</div>
<div class="line">    colName[5] = <span class="stringliteral">&quot;fcomplex-roots&quot;</span>;</div>
<div class="line">    colName[6] = <span class="stringliteral">&quot;scalar-complex&quot;</span>;</div>
<div class="line"></div>
<div class="line">    colForm[0] = <span class="stringliteral">&quot;8A&quot;</span>;</div>
<div class="line">    colForm[1] = <span class="stringliteral">&quot;20J&quot;</span>;</div>
<div class="line">    colForm[2] = <span class="stringliteral">&quot;20D&quot;</span>;</div>
<div class="line">    colForm[3] = <span class="stringliteral">&quot;20V&quot;</span>;</div>
<div class="line">    colForm[4] = <span class="stringliteral">&quot;20M&quot;</span>;</div>
<div class="line">    colForm[5] = <span class="stringliteral">&quot;20C&quot;</span>;</div>
<div class="line">    colForm[6] = <span class="stringliteral">&quot;1M&quot;</span>;</div>
<div class="line"></div>
<div class="line">    colUnit[0] = <span class="stringliteral">&quot;magnets&quot;</span>;</div>
<div class="line">    colUnit[1] = <span class="stringliteral">&quot;bulbs&quot;</span>;</div>
<div class="line">    colUnit[2] = <span class="stringliteral">&quot;batteries&quot;</span>;</div>
<div class="line">    colUnit[3] = <span class="stringliteral">&quot;mulberries&quot;</span>;</div>
<div class="line">    colUnit[4] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">    colUnit[5] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">    colUnit[6] = <span class="stringliteral">&quot;pico boo&quot;</span>;</div>
<div class="line">    </div>
<div class="line">    std::vector&lt;string&gt; numbers(rows);</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> num(<span class="stringliteral">&quot;NUMBER-&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; rows; ++j)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef HAVE_STRSTREAM</span></div>
<div class="line"><span class="preprocessor"></span>        std::ostrstream pStr;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        std::ostringstream pStr;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        pStr &lt;&lt; num &lt;&lt; j+1;</div>
<div class="line">        numbers[j] = string(pStr.str());</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> OFFSET(20);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// write operations take in data as valarray&lt;T&gt;, vector&lt;T&gt; , and </span></div>
<div class="line">    <span class="comment">// vector&lt;valarray&lt;T&gt; &gt;, and T* C-arrays. Create arrays to exercise the C++</span></div>
<div class="line">    <span class="comment">// containers. Check complex I/O for both float and double complex types.</span></div>
<div class="line">   </div>
<div class="line">    std::valarray&lt;long&gt; sequence(60);</div>
<div class="line">    std::vector&lt;long&gt; sequenceVector(60);</div>
<div class="line">    std::vector&lt;std::valarray&lt;long&gt; &gt; sequenceVV(3);</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; rows; ++j)</div>
<div class="line">    {</div>
<div class="line">        sequence[OFFSET*j] = 1 + j;</div>
<div class="line">        sequence[OFFSET*j+1] = 1 + j;</div>
<div class="line">        sequenceVector[OFFSET*j] = sequence[OFFSET*j];</div>
<div class="line">        sequenceVector[OFFSET*j+1] = sequence[OFFSET*j+1];</div>
<div class="line">        <span class="comment">// generate Fibonacci numbers.</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 2; i &lt; OFFSET; ++i)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">size_t</span> elt (OFFSET*j +i);</div>
<div class="line">            sequence[elt] = sequence[elt-1] + sequence[elt - 2];</div>
<div class="line">            sequenceVector[elt] = sequence[elt] ;</div>
<div class="line">        }</div>
<div class="line">        sequenceVV[j].resize(OFFSET);</div>
<div class="line">        sequenceVV[j] = sequence[std::slice(OFFSET*j,OFFSET,1)];</div>
<div class="line">         </div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::valarray&lt;unsigned long&gt; unsignedData(60);</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> base (1 &lt;&lt; 31);</div>
<div class="line">    std::valarray&lt;double&gt; powers(60);</div>
<div class="line">    std::vector&lt;double&gt; powerVector(60);</div>
<div class="line">    std::vector&lt;std::valarray&lt;double&gt; &gt; powerVV(3);</div>
<div class="line">    std::valarray&lt;std::complex&lt;double&gt; &gt; croots(60);</div>
<div class="line">    std::valarray&lt;std::complex&lt;float&gt; &gt; fcroots(60);</div>
<div class="line">    std::vector&lt;std::complex&lt;float&gt; &gt; fcroots_vector(60);</div>
<div class="line">    std::vector&lt;std::valarray&lt;std::complex&lt;float&gt; &gt; &gt; fcrootv(3);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// create complex data as 60th roots of unity.</span></div>
<div class="line">    <span class="keywordtype">double</span> PIBY = M_PI/30.;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; rows; ++j)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; OFFSET; ++i)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">size_t</span> elt (OFFSET*j+i);</div>
<div class="line">            unsignedData[elt] = sequence[elt];</div>
<div class="line">            croots[elt] = std::complex&lt;double&gt;(std::cos(PIBY*elt),std::sin(PIBY*elt));</div>
<div class="line">            fcroots[elt] = std::complex&lt;float&gt;(croots[elt].real(),croots[elt].imag());</div>
<div class="line">            <span class="keywordtype">double</span> x = i+1;</div>
<div class="line">            powers[elt] = pow(x,j+1);</div>
<div class="line">            powerVector[elt] = powers[elt];</div>
<div class="line">        }</div>
<div class="line">        powerVV[j].resize(OFFSET);</div>
<div class="line">        powerVV[j] = powers[std::slice(OFFSET*j,OFFSET,1)];</div>
<div class="line">      }</div>
<div class="line">    </div>
<div class="line">    FITSUtil::fill(fcroots_vector,fcroots[std::slice(0,20,1)]);</div>
<div class="line">    </div>
<div class="line">    unsignedData += base;</div>
<div class="line">    <span class="comment">// syntax identical to Binary Table</span></div>
<div class="line">    </div>
<div class="line">    Table* newTable = pFits-&gt;addTable(hduName,rows,colName,colForm,colUnit);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// numbers is a scalar column</span></div>
<div class="line">    </div>
<div class="line">    newTable-&gt;column(colName[0]).write(numbers,1);  </div>
<div class="line">    </div>
<div class="line">    <span class="comment">// write valarrays to vector column: note signature change</span></div>
<div class="line">    </div>
<div class="line">    newTable-&gt;column(colName[1]).write(sequence,rows,1);</div>
<div class="line">    newTable-&gt;column(colName[2]).write(powers,rows,1);</div>
<div class="line">    newTable-&gt;column(colName[3]).write(unsignedData,rows,1);</div>
<div class="line">    newTable-&gt;column(colName[4]).write(croots,rows,1);</div>
<div class="line">    newTable-&gt;column(colName[5]).write(fcroots,rows,3);</div>
<div class="line">    newTable-&gt;column(colName[6]).write(fcroots_vector,1);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// write vectors to column: note signature change</span></div>
<div class="line">    </div>
<div class="line">    newTable-&gt;column(colName[1]).write(sequenceVector,rows,4);</div>
<div class="line">    newTable-&gt;column(colName[2]).write(powerVector,rows,4);</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; *newTable &lt;&lt; std::endl;</div>
<div class="line">   </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; 3 ;  ++j)</div>
<div class="line">    {</div>
<div class="line">        fcrootv[j].resize(20);</div>
<div class="line">        fcrootv[j] = fcroots[std::slice(20*j,20,1)];</div>
<div class="line">    } </div>
<div class="line"></div>
<div class="line">    <span class="comment">// write vector&lt;valarray&gt; object to column.</span></div>
<div class="line">    </div>
<div class="line">    newTable-&gt;column(colName[1]).writeArrays(sequenceVV,7);</div>
<div class="line">    newTable-&gt;column(colName[2]).writeArrays(powerVV,7);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a new vector column in the Table</span></div>
<div class="line"></div>
<div class="line">    newTable-&gt;addColumn(Tfloat,<span class="stringliteral">&quot;powerSeq&quot;</span>,20,<span class="stringliteral">&quot;none&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add data entries to it.</span></div>
<div class="line"></div>
<div class="line">    newTable-&gt;column(<span class="stringliteral">&quot;powerSeq&quot;</span>).writeArrays(powerVV,1);</div>
<div class="line">    newTable-&gt;column(<span class="stringliteral">&quot;powerSeq&quot;</span>).write(powerVector,rows,4);</div>
<div class="line">    newTable-&gt;column(<span class="stringliteral">&quot;dcomplex-roots&quot;</span>).write(croots,rows,4);</div>
<div class="line">    newTable-&gt;column(<span class="stringliteral">&quot;powerSeq&quot;</span>).write(sequenceVector,rows,7);</div>
<div class="line">    </div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; *newTable &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// delete one of the original columns.</span></div>
<div class="line"></div>
<div class="line">    newTable-&gt;deleteColumn(colName[2]);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add a new set of rows starting after row 3. So we&#39;ll have 14 with</span></div>
<div class="line">    <span class="comment">// rows 4,5,6,7,8 blank</span></div>
<div class="line"></div>
<div class="line">    newTable-&gt;insertRows(3,5);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// now, in the new column, write 3 rows (sequenceVV.size() = 3). This</span></div>
<div class="line">    <span class="comment">// will place data in rows 3,4,5 of this column,overwriting them.</span></div>
<div class="line">    </div>
<div class="line">    newTable-&gt;column(<span class="stringliteral">&quot;powerSeq&quot;</span>).writeArrays(sequenceVV,3);</div>
<div class="line">    newTable-&gt;column(<span class="stringliteral">&quot;fcomplex-roots&quot;</span>).writeArrays(fcrootv,3);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// delete 3 rows starting with row 2. A Table:: method, so the same</span></div>
<div class="line">    <span class="comment">// code is called for all Table objects. We should now have 11 rows.</span></div>
<div class="line">    </div>
<div class="line">    newTable-&gt;deleteRows(2,3);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//add a history string. This function call is in HDU:: so is identical</span></div>
<div class="line">    <span class="comment">//for all HDUs</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">string</span> hist(<span class="stringliteral">&quot;This file was created for testing CCfits write functionality&quot;</span>);</div>
<div class="line">    hist += <span class="stringliteral">&quot; it serves no other useful purpose. This particular part of the file was &quot;</span>;</div>
<div class="line">    hist += <span class="stringliteral">&quot; constructed to test the writeHistory() and writeComment() functionality&quot;</span> ;</div>
<div class="line"></div>
<div class="line">    newTable-&gt;writeHistory(hist);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// add a comment string. Use std::string method to change the text in the message</span></div>
<div class="line">    <span class="comment">// and write the previous junk as a comment.</span></div>
<div class="line"></div>
<div class="line">    hist.insert(0, <span class="stringliteral">&quot; COMMENT TEST &quot;</span>);</div>
<div class="line"></div>
<div class="line">    newTable-&gt;writeComment(hist);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ... print the result.</span></div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; *newTable &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 27 2021 16:31:26 for CCfits by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
